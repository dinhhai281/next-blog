<!DOCTYPE html><html lang="vi"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><style data-href="/next-blog/styles.696403ca8166ceb7a934.css" id="gatsby-global-css">@import url(https://fonts.googleapis.com/css2?family=Montserrat:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap);.article{font-family:Montserrat}.article a,.article button,.article input{-webkit-tap-highlight-color:transparent}.article p{color:#292929;letter-spacing:-.003em;line-height:32px;font-size:21px;margin-top:2em;margin-bottom:-.46em}.article p:first-child{margin-top:1.1em}.article a{text-decoration:underline;color:inherit}.article h1{line-height:36px;margin-top:1.95em;font-size:30px;letter-spacing:0;margin-bottom:-.28em}.article h1,.article h2{color:#292929;font-weight:500}.article h2{margin-top:1em;font-size:26px;margin-bottom:-.36em}.article h4{color:#292929;font-size:22px;margin-bottom:-.26em;font-weight:500}.article pre{margin-top:.8em}.article ul{color:#292929;letter-spacing:-.003em;line-height:32px;font-size:21px;margin-top:1em;margin-bottom:-.46em}code[class*=language-],pre[class*=language-]{color:#f8f8f2;background:none;text-shadow:0 1px rgba(0,0,0,.3);font-family:Consolas,Monaco,Andale Mono,Ubuntu Mono,monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-ms-hyphens:none;hyphens:none}pre[class*=language-]{padding:1em;margin:.5em 0;overflow:auto;border-radius:.3em}:not(pre)>code[class*=language-],pre[class*=language-]{background:#272822}:not(pre)>code[class*=language-]{padding:.1em;border-radius:.3em;white-space:normal}.token.cdata,.token.comment,.token.doctype,.token.prolog{color:#8292a2}.token.punctuation{color:#f8f8f2}.token.namespace{opacity:.7}.token.constant,.token.deleted,.token.property,.token.symbol,.token.tag{color:#f92672}.token.boolean,.token.number{color:#ae81ff}.token.attr-name,.token.builtin,.token.char,.token.inserted,.token.selector,.token.string{color:#a6e22e}.language-css .token.string,.style .token.string,.token.entity,.token.operator,.token.url,.token.variable{color:#f8f8f2}.token.atrule,.token.attr-value,.token.class-name,.token.function{color:#e6db74}.token.keyword{color:#66d9ef}.token.important,.token.regex{color:#fd971f}.token.bold,.token.important{font-weight:700}.token.italic{font-style:italic}.token.entity{cursor:help}</style><meta name="generator" content="Gatsby 2.32.3"/><title data-react-helmet="true">State Management Trong Angular Với NgRx | Hai Nguyen</title><meta data-react-helmet="true" name="description" content="Hai&#x27;s Personal Blog"/><meta data-react-helmet="true" name="keywords" content="Blog,React,Angular,Javascript,Typescript,Functional Programming"/><meta data-react-helmet="true" property="og:title" content="State Management Trong Angular Với NgRx"/><meta data-react-helmet="true" property="og:type" content="website"/><link as="script" rel="preload" href="/next-blog/webpack-runtime-6ce45a7ec86322bce28b.js"/><link as="script" rel="preload" href="/next-blog/framework-8aba4025690a031b46dc.js"/><link as="script" rel="preload" href="/next-blog/styles-755093da0c07f4b49226.js"/><link as="script" rel="preload" href="/next-blog/app-68672042ae7cb9401002.js"/><link as="script" rel="preload" href="/next-blog/05d954cf-c6db298c906c9c30084e.js"/><link as="script" rel="preload" href="/next-blog/commons-518e58bf6a7d4015b30b.js"/><link as="script" rel="preload" href="/next-blog/022d3153bf09c36cd784dcdb36ffbd187f9c96d7-8695945ca61dfd864cb3.js"/><link as="script" rel="preload" href="/next-blog/component---src-templates-blog-post-tsx-66c6938f7d1532686151.js"/><link as="fetch" rel="preload" href="/next-blog/page-data/vi/state-management-with-ngrx-in-angular/page-data.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/next-blog/page-data/sq/d/4033596395.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/next-blog/page-data/app-data.json" crossorigin="anonymous"/></head><body><script>(function setScript(initialValue) {
  var mql = window.matchMedia("(prefers-color-scheme: dark)");
  var systemPreference = mql.matches ? "dark" : "light";
  var persistedPreference;

  try {
    persistedPreference = localStorage.getItem("chakra-ui-color-mode");
  } catch (error) {
    console.log("Chakra UI: localStorage is not available. Color mode persistence might not work as expected");
  }

  var isInStorage = typeof persistedPreference === "string";
  var colorMode;

  if (isInStorage) {
    colorMode = persistedPreference;
  } else {
    colorMode = initialValue === "system" ? systemPreference : initialValue;
  }

  if (colorMode) {
    var root = document.documentElement;
    root.style.setProperty("--chakra-ui-color-mode", colorMode);
  }
})('light')</script><div id="___gatsby"><style data-emotion="css-global 1syi0wy">html{line-height:1.5;-webkit-text-size-adjust:100%;font-family:system-ui,sans-serif;-webkit-font-smoothing:antialiased;text-rendering:optimizeLegibility;-moz-osx-font-smoothing:grayscale;touch-action:manipulation;}body{position:relative;min-height:100%;font-feature-settings:'kern';}*,*::before,*::after{border-width:0;border-style:solid;box-sizing:border-box;}main{display:block;}hr{border-top-width:1px;box-sizing:content-box;height:0;overflow:visible;}pre,code,kbd,samp{font-family:SFMono-Regular,Menlo,Monaco,Consolas,monospace;font-size:1em;}a{background-color:transparent;color:inherit;-webkit-text-decoration:inherit;text-decoration:inherit;}abbr[title]{border-bottom:none;-webkit-text-decoration:underline;text-decoration:underline;-webkit-text-decoration:underline dotted;-webkit-text-decoration:underline dotted;text-decoration:underline dotted;}b,strong{font-weight:bold;}small{font-size:80%;}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline;}sub{bottom:-0.25em;}sup{top:-0.5em;}img{border-style:none;}button,input,optgroup,select,textarea{font-family:inherit;font-size:100%;line-height:1.15;margin:0;}button,input{overflow:visible;}button,select{text-transform:none;}button::-moz-focus-inner,[type="button"]::-moz-focus-inner,[type="reset"]::-moz-focus-inner,[type="submit"]::-moz-focus-inner{border-style:none;padding:0;}fieldset{padding:0.35em 0.75em 0.625em;}legend{box-sizing:border-box;color:inherit;display:table;max-width:100%;padding:0;white-space:normal;}progress{vertical-align:baseline;}textarea{overflow:auto;}[type="checkbox"],[type="radio"]{box-sizing:border-box;padding:0;}[type="number"]::-webkit-inner-spin-button,[type="number"]::-webkit-outer-spin-button{-webkit-appearance:none!important;}input[type="number"]{-moz-appearance:textfield;}[type="search"]{-webkit-appearance:textfield;outline-offset:-2px;}[type="search"]::-webkit-search-decoration{-webkit-appearance:none!important;}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit;}details{display:block;}summary{display:-webkit-box;display:-webkit-list-item;display:-ms-list-itembox;display:list-item;}template{display:none;}[hidden]{display:none!important;}body,blockquote,dl,dd,h1,h2,h3,h4,h5,h6,hr,figure,p,pre{margin:0;}button{background:transparent;padding:0;}fieldset{margin:0;padding:0;}ol,ul{margin:0;padding:0;}textarea{resize:vertical;}button,[role="button"]{cursor:pointer;}button::-moz-focus-inner{border:0!important;}table{border-collapse:collapse;}h1,h2,h3,h4,h5,h6{font-size:inherit;font-weight:inherit;}button,input,optgroup,select,textarea{padding:0;line-height:inherit;color:inherit;}img,svg,video,canvas,audio,iframe,embed,object{display:block;vertical-align:middle;}img,video{max-width:100%;height:auto;}[data-js-focus-visible] :focus:not([data-focus-visible-added]){outline:none;box-shadow:none;}select::-ms-expand{display:none;}</style><style data-emotion="css-global 1rxzalh">body{font-family:Montserrat;color:#1A202C;background:#FFFFFF;-webkit-transition:background-color 0.2s;transition:background-color 0.2s;line-height:1.5;}*::-webkit-input-placeholder{color:#A0AEC0;}*::-moz-placeholder{color:#A0AEC0;}*:-ms-input-placeholder{color:#A0AEC0;}*::placeholder{color:#A0AEC0;}*,*::before,::after{border-color:#E2E8F0;word-wrap:break-word;}</style><div style="outline:none" tabindex="-1" id="gatsby-focus-wrapper"><style data-emotion="css ldo4d5">.css-ldo4d5{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:center;-ms-flex-pack:center;-webkit-justify-content:center;justify-content:center;width:100%;}</style><div class="css-ldo4d5"><style data-emotion="css 1elhtw7">.css-1elhtw7{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;padding-left:2rem;padding-right:2rem;padding-top:6rem;padding-bottom:6rem;width:100%;max-width:56rem;}.css-1elhtw7>*:not(style)~*:not(style){margin-top:0.5rem;-webkit-margin-start:0;margin-inline-start:0;}</style><div class="chakra-stack css-1elhtw7"><style data-emotion="css esc6ow">.css-esc6ow{width:100%;text-align:center;font-size:3.75rem;font-weight:700;margin-bottom:2rem;color:#2D3748;}</style><p class="chakra-text css-esc6ow">State Management Trong Angular Với NgRx</p><style data-emotion="css 1lg3zhh">.css-1lg3zhh{width:150%;margin-top:2rem;margin-bottom:2rem;max-width:1200px;}</style><div class="css-1lg3zhh"><div class=" gatsby-image-wrapper" style="position:relative;overflow:hidden"><div aria-hidden="true" style="width:100%;padding-bottom:48.148148148148145%"></div><img aria-hidden="true" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAIAAAA7N+mxAAAACXBIWXMAAAsTAAALEwEAmpwYAAABKklEQVQoz6VQTUvDQBDt//AkIqLU7uzMJLtJSDQfpUkqHlrqBz0UwZtYFMSLFPFmPXrx4o91kqiUVEFwdmD3vdk3s287+I/oNJuuY/28GgDQ4j/FzGysISKpsuMYYwipJbbGSmrUq2IS6FmvyIeuYxRA6AdJlinSXJcQtDSSmWmRZnkqjMC6NXUIWeo+x4kzcckX7mHn6n3jpuiFPQTrWt/zNegojBbe811/EWexrts14qpN3zsrg4vIG5Uqed28Pe2WJ2q8292bnk/n1/P9XncQ5C/B2+NgWSRDBYqJG7GMdg7NcWLHB+YIie+3R09bsxwGgGAcV3ySJnZ5lExm/Utr7ffLm8kVYOTKG6K4DcDIr1Pjub4qSBaQanmm9dSIP/Caq/yCv4r/mB9+SoGUOEIkAQAAAABJRU5ErkJggg==" alt="featured-image" style="position:absolute;top:0;left:0;width:100%;height:100%;object-fit:cover;object-position:center;opacity:1;transition-delay:500ms"/><noscript><picture><source srcset="/next-blog/static/87ffd824dd8c7491b87410f85f57d6cb/5ca18/ngrx-featured.png 270w,
/next-blog/static/87ffd824dd8c7491b87410f85f57d6cb/13528/ngrx-featured.png 540w,
/next-blog/static/87ffd824dd8c7491b87410f85f57d6cb/05d05/ngrx-featured.png 1080w,
/next-blog/static/87ffd824dd8c7491b87410f85f57d6cb/a481c/ngrx-featured.png 1087w" sizes="(max-width: 1080px) 100vw, 1080px" /><img loading="lazy" sizes="(max-width: 1080px) 100vw, 1080px" srcset="/next-blog/static/87ffd824dd8c7491b87410f85f57d6cb/5ca18/ngrx-featured.png 270w,
/next-blog/static/87ffd824dd8c7491b87410f85f57d6cb/13528/ngrx-featured.png 540w,
/next-blog/static/87ffd824dd8c7491b87410f85f57d6cb/05d05/ngrx-featured.png 1080w,
/next-blog/static/87ffd824dd8c7491b87410f85f57d6cb/a481c/ngrx-featured.png 1087w" src="/next-blog/static/87ffd824dd8c7491b87410f85f57d6cb/05d05/ngrx-featured.png" alt="featured-image" style="position:absolute;top:0;left:0;opacity:1;width:100%;height:100%;object-fit:cover;object-position:center"/></picture></noscript></div></div><style data-emotion="css 9yfthd">.css-9yfthd{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;width:100%;}.css-9yfthd>*:not(style)~*:not(style){-webkit-margin-start:0.5rem;margin-inline-start:0.5rem;margin-top:0;}</style><div class="chakra-stack css-9yfthd"><style data-emotion="css 167hdm8">.css-167hdm8{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;position:fixed;top:3rem;left:calc((100vw - 1200px) / 2 + .5rem);width:calc((1200px - 896px) / 2 - 16px);}</style><div class="css-167hdm8"><style data-emotion="css 1t8mbiy">.css-1t8mbiy{color:#97266D;margin-bottom:1rem;font-size:1.125rem;font-weight:600;}</style><p class="chakra-text css-1t8mbiy">Hai Nguyen&#x27;s Blog</p><style data-emotion="css lytb1o">.css-lytb1o{font-size:0.875rem;margin-bottom:0.5rem;color:#1A202C;}</style><p class="chakra-text css-lytb1o">Get better on coding, cooking and gamming everyday.</p><style data-emotion="css svjswr">.css-svjswr{opacity:0.6;border:0;border-color:inherit;border-style:solid;border-bottom-width:1px;width:100%;}</style><hr role="separator" aria-orientation="horizontal" class="chakra-divider css-svjswr"/><style data-emotion="css 7obav3">.css-7obav3{display:-webkit-inline-box;display:-webkit-inline-flex;display:-ms-inline-flexbox;display:inline-flex;-webkit-appearance:none;-moz-appearance:none;-ms-appearance:none;appearance:none;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-ms-flex-pack:center;-webkit-justify-content:center;justify-content:center;-webkit-transition:all 250ms;transition:all 250ms;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;position:relative;white-space:nowrap;vertical-align:middle;outline:none;width:auto;line-height:1.2;border-radius:0.375rem;font-weight:600;height:2.5rem;min-width:2.5rem;font-size:1rem;padding-left:1rem;padding-right:1rem;background:#EDF2F7;margin-top:1rem;}.css-7obav3:focus,.css-7obav3[data-focus]{box-shadow:0 0 0 3px rgba(66, 153, 225, 0.6);}.css-7obav3[disabled],.css-7obav3[disabled]:focus,.css-7obav3[disabled]:hover,.css-7obav3[aria-disabled=true],.css-7obav3[aria-disabled=true]:focus,.css-7obav3[aria-disabled=true]:hover,.css-7obav3[data-disabled],.css-7obav3[data-disabled]:focus,.css-7obav3[data-disabled]:hover{opacity:0.4;cursor:not-allowed;box-shadow:none;}.css-7obav3:hover,.css-7obav3[data-hover]{background:#E2E8F0;}.css-7obav3:hover[disabled],.css-7obav3[data-hover][disabled],.css-7obav3:hover[disabled]:focus,.css-7obav3[data-hover][disabled]:focus,.css-7obav3:hover[disabled]:hover,.css-7obav3[data-hover][disabled]:hover,.css-7obav3:hover[aria-disabled=true],.css-7obav3[data-hover][aria-disabled=true],.css-7obav3:hover[aria-disabled=true]:focus,.css-7obav3[data-hover][aria-disabled=true]:focus,.css-7obav3:hover[aria-disabled=true]:hover,.css-7obav3[data-hover][aria-disabled=true]:hover,.css-7obav3:hover[data-disabled],.css-7obav3[data-hover][data-disabled],.css-7obav3:hover[data-disabled]:focus,.css-7obav3[data-hover][data-disabled]:focus,.css-7obav3:hover[data-disabled]:hover,.css-7obav3[data-hover][data-disabled]:hover{background:#EDF2F7;}.css-7obav3:active,.css-7obav3[data-active]{background:#CBD5E0;}</style><a class="chakra-button css-7obav3" href="/next-blog/vi/">Back</a></div><style data-emotion="css 17jpevf">.css-17jpevf{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;margin-right:3rem;}</style><div class="css-17jpevf"><style data-emotion="css 9at4gq">.css-9at4gq{border-radius:9999px;display:-webkit-inline-box;display:-webkit-inline-flex;display:-ms-inline-flexbox;display:inline-flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-ms-flex-pack:center;-webkit-justify-content:center;justify-content:center;text-align:center;text-transform:uppercase;font-weight:500;position:relative;-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;background:#A0AEC0;color:#1A202C;border-color:#FFFFFF;vertical-align:top;width:3rem;height:3rem;font-size:calc(3rem / 2.5);margin-right:1rem;}</style><span class="chakra-avatar css-9at4gq"><style data-emotion="css 16ite8i">.css-16ite8i{color:#fff;width:100%;height:100%;}</style><svg viewBox="0 0 128 128" role="img" class="css-16ite8i"><path fill="currentColor" d="M103,102.1388 C93.094,111.92 79.3504,118 64.1638,118 C48.8056,118 34.9294,111.768 25,101.7892 L25,95.2 C25,86.8096 31.981,80 40.6,80 L87.4,80 C96.019,80 103,86.8096 103,95.2 L103,102.1388 Z"></path><path fill="currentColor" d="M63.9961647,24 C51.2938136,24 41,34.2938136 41,46.9961647 C41,59.7061864 51.2938136,70 63.9961647,70 C76.6985159,70 87,59.7061864 87,46.9961647 C87,34.2938136 76.6985159,24 63.9961647,24"></path></svg></span><style data-emotion="css 1ei42wq">.css-1ei42wq{color:#2D3748;margin-right:0.25rem;font-size:1.25rem;}</style><p class="chakra-text css-1ei42wq">by</p><style data-emotion="css 1rm39z5">.css-1rm39z5{font-size:1.25rem;color:#2D3748;-webkit-text-decoration:underline;text-decoration:underline;}</style><a class="chakra-text css-1rm39z5" href="https://github.con/dinhhai281">Hai Nguyen</a></div><style data-emotion="css 70qvj9">.css-70qvj9{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;}</style><div class="css-70qvj9"><style data-emotion="css 1b30jsj">.css-1b30jsj{width:1.5rem;height:1.5rem;display:inline-block;line-height:1em;-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;color:#2D3748;vertical-align:middle;margin-right:1rem;}</style><svg viewBox="0 0 14 14" focusable="false" class="chakra-icon css-1b30jsj"><path fill="currentColor" d="M10.8889,5.5 L3.11111,5.5 L3.11111,7.05556 L10.8889,7.05556 L10.8889,5.5 Z M12.4444,1.05556 L11.6667,1.05556 L11.6667,0 L10.1111,0 L10.1111,1.05556 L3.88889,1.05556 L3.88889,0 L2.33333,0 L2.33333,1.05556 L1.55556,1.05556 C0.692222,1.05556 0.00777777,1.75556 0.00777777,2.61111 L0,12.5 C0,13.3556 0.692222,14 1.55556,14 L12.4444,14 C13.3,14 14,13.3556 14,12.5 L14,2.61111 C14,1.75556 13.3,1.05556 12.4444,1.05556 Z M12.4444,12.5 L1.55556,12.5 L1.55556,3.94444 L12.4444,3.94444 L12.4444,12.5 Z M8.55556,8.61111 L3.11111,8.61111 L3.11111,10.1667 L8.55556,10.1667 L8.55556,8.61111 Z"></path></svg><style data-emotion="css zbloxw">.css-zbloxw{font-size:1.25rem;color:#2D3748;}</style><p class="chakra-text css-zbloxw">28 September, 2020</p></div></div><style data-emotion="css 8atqhb">.css-8atqhb{width:100%;}</style><div class="article css-8atqhb" data-testid="post-content"><p>State Management hay quản lý state là một khái niệm khá phổ biến ở React và Angular cũng đã có một sự giao lưu tuyệt vời với nó qua NgRx - Reactive State for Angular. Bài viết này mình sẽ chia sẽ về cách tổ chức state của mình khi sử dụng NgRx.</p>
<h1>State là gì?</h1>
<p>Với những ai đã từng sử dụng qua React thì state và props là 2 khái niệm đã quá quen thuộc, nhưng nếu bạn chỉ biết đến Angular thì có thể sẽ không biết đến nó dù bạn vẫn dùng nó mỗi ngày.</p>
<p><strong>State:</strong> Là những thứ được quản lý bên trong component ví dụ bạn có một property để lưu lại một giá trị thì nó có thể được gọi là state. Trong React mỗi khi state thay đổi thì component sẽ re-render. Còn trong Angular thì tuỳ trường hợp mà có thể khi bạn thay đổi state thì component sẽ không re-render. Đề có được cơ chế re-render tương tự trong Angular thì thay vì sử dụng dùng một biến kiểu string để lưu một chuỗi và mutate nó mỗi khi cần thay đổi thì hãy dùng BehaviorSubject và next giá trị mới khi cần thay đổi và async pipe để hiển thị giá trị đó ra ngoài.</p>
<p>Việc có thể sử dụng RxJS để tạo ra "State" đã làm cho sự khác biệt về React và Angular không còn quá lớn. Rất nhiều những kỹ thuật được dùng trong React có thể được áp dụng trong Angular và ngược lại. Trong đó <strong>Flux Architect</strong> là một trong những thứ rất đáng học hỏi để tạo ra những web application có khả năng scale tốt hơn.</p>
<h1>NgRx - Reactive State cho Angular</h1>
<p><code class="language-text">Redux</code> là một state management library cực kỳ phổ biến trong cộng đồng React cho việc quản lý state theo Flux Architect và <code class="language-text">NgRx</code> được truyền cảm hứng dựa trên Redux để giải quyết vấn đề tương tự cho Angular.</p>
<p>So với Redux thì có thể nói NgRx hoàn thiện hơn rất nhiều và đúng với phong cách của Angular nó có đầy đủ các món ăn chơi để có thể giải quyết mọi vấn đề mà một developer phải đối mặt khi sử dụng state management library.</p>
<p>Khác với Redux, để sử dụng tốt NgRx thì phải có một sự hiểu biết tương đối về Reactive Programming vì state trong NgRx là Reactive State - <strong>Everything is stream</strong> -</p>
<p><strong>Giới thiệu vậy thôi chứ bài viết này không nhằm mục đích hướng dẫn sử dụng NgRx nên sẽ không hướng dẫn xài cái này đâu nha.</strong></p>
<h1>Store module</h1>
<p>Việc sử dụng NgRx không có nghĩa là sẽ bỏ qua hoàn toàn local state, chỉ những thứ cần thiết mới nên được lưu trên store. Store này mình thường tách thành một module riêng trong đó sẽ có nhiều store feature module.</p>
<p>Store module này sẽ được import vào AppModule, đồng nghĩa mình sẽ không lazy load store module này. Store module với toàn bộ state sẽ được load ngay từ đầu cho dù có thể feature sử dụng nó có lazy load đi nữa.</p>
<p>Tất nhiên nếu bundle size là một trong những yếu tố quan trọng với project của bạn thì cái store feature module cũng có thể được lazy load nhưng hãy chú ý về những gì store feature module đó có nhé.</p>
<p>Trong Store module này thường sẽ không có gì cả, đây chỉ là nơi để setup NgRx và import các store feature module.</p>
<h2>store/store.module.ts</h2>
<div class="gatsby-highlight" data-language="typescript"><pre class="language-typescript"><code class="language-typescript"><span class="token keyword">import</span> <span class="token punctuation">{</span> CommonModule <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@angular/common'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> NgModule <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@angular/core'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> EffectsModule <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@ngrx/effects'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> StoreModule <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@ngrx/store'</span><span class="token punctuation">;</span>

@<span class="token function">NgModule</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  declarations<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  imports<span class="token operator">:</span> <span class="token punctuation">[</span>
    CommonModule<span class="token punctuation">,</span>
    StoreModule<span class="token punctuation">.</span><span class="token function">forRoot</span><span class="token punctuation">(</span>
      <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        runtimeChecks<span class="token operator">:</span> <span class="token punctuation">{</span>
          strictActionImmutability<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
          strictStateSerializability<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
          strictActionSerializability<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
          strictStateImmutability<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
          strictActionTypeUniqueness<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">)</span><span class="token punctuation">,</span>
    EffectsModule<span class="token punctuation">.</span><span class="token function">forRoot</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    environment<span class="token punctuation">.</span>storeInstrument<span class="token punctuation">,</span>
    PostFeatureStoreModule<span class="token punctuation">,</span>
    AuthFeatureStoreModule<span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">AppStoreModule</span> <span class="token punctuation">{</span><span class="token punctuation">}</span></code></pre></div>
<h2>store/reducer.ts</h2>
<div class="gatsby-highlight" data-language="typescript"><pre class="language-typescript"><code class="language-typescript"><span class="token keyword">export</span> <span class="token keyword">interface</span> <span class="token class-name">State</span> <span class="token punctuation">{</span><span class="token punctuation">}</span></code></pre></div>
<h1>Store Feature Module</h1>
<p>Khi cần quản lý một thứ gì đó bằng store thì hãy tách nó thành một Store Feature Module sau đó import ngược lại vào Store Module. Như vậy sẽ dễ hơn trong việc tổ chức code và những logic về một loại state nào đó sẽ được tách biệt.</p>
<p>Ví dụ trong app có một feature là login thì hãy tạo một <code class="language-text">AuthFeatureStoreModule</code>, trong đó có đầy đủ các action, reducer, selector, effects để bạn có thể xử lý mọi logic có thể xảy ra với việc login.</p>
<p><strong>store/auth/auth.reducer.ts</strong></p>
<div class="gatsby-highlight" data-language="typescript"><pre class="language-typescript"><code class="language-typescript"><span class="token keyword">import</span> <span class="token punctuation">{</span> User <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@app/models'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Action<span class="token punctuation">,</span> createReducer<span class="token punctuation">,</span> on <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@ngrx/store'</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token punctuation">{</span> login<span class="token punctuation">,</span> loginFailure<span class="token punctuation">,</span> loginSuccess <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./auth.action'</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token constant">AUTH_FEATURE_KEY</span> <span class="token operator">=</span> <span class="token string">'auth'</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">interface</span> <span class="token class-name">AuthState</span> <span class="token punctuation">{</span>
  me<span class="token operator">:</span> User<span class="token punctuation">;</span>
  token<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
  loading<span class="token operator">:</span> <span class="token builtin">boolean</span><span class="token punctuation">;</span>
  error<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> initialState<span class="token operator">:</span> AuthState <span class="token operator">=</span> <span class="token punctuation">{</span>
  me<span class="token operator">:</span> <span class="token keyword">undefined</span><span class="token punctuation">,</span>
  token<span class="token operator">:</span> <span class="token keyword">undefined</span><span class="token punctuation">,</span>
  loading<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
  error<span class="token operator">:</span> <span class="token keyword">undefined</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> _authReducer <span class="token operator">=</span> <span class="token function">createReducer</span><span class="token punctuation">(</span>
  initialState<span class="token punctuation">,</span>
  <span class="token function">on</span><span class="token punctuation">(</span>login<span class="token punctuation">,</span> state <span class="token operator">=></span> <span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token operator">...</span>state<span class="token punctuation">,</span> loading<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token function">on</span><span class="token punctuation">(</span>loginSuccess<span class="token punctuation">,</span> <span class="token punctuation">(</span>state<span class="token punctuation">,</span> <span class="token punctuation">{</span> user<span class="token punctuation">,</span> token <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token operator">...</span>state<span class="token punctuation">,</span> loading<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> user<span class="token punctuation">,</span> token <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token function">on</span><span class="token punctuation">(</span>loginFailure<span class="token punctuation">,</span> <span class="token punctuation">(</span>state<span class="token punctuation">,</span> <span class="token punctuation">{</span> error <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token operator">...</span>state<span class="token punctuation">,</span> loading<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> error <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">reducer</span><span class="token punctuation">(</span>state<span class="token operator">:</span> AuthState <span class="token operator">|</span> <span class="token keyword">undefined</span><span class="token punctuation">,</span> action<span class="token operator">:</span> Action<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token function">_authReducer</span><span class="token punctuation">(</span>state<span class="token punctuation">,</span> action<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<br>
<h2>store/auth/auth.action.ts</h2>
<div class="gatsby-highlight" data-language="typescript"><pre class="language-typescript"><code class="language-typescript"><span class="token keyword">import</span> <span class="token punctuation">{</span> User <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@app/models'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> createAction<span class="token punctuation">,</span> props <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@ngrx/store'</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">const</span> login <span class="token operator">=</span> <span class="token function">createAction</span><span class="token punctuation">(</span><span class="token string">'[Auth] Login'</span><span class="token punctuation">,</span> <span class="token generic-function"><span class="token function">props</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token punctuation">{</span> email<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span> password<span class="token operator">:</span> <span class="token builtin">string</span> <span class="token punctuation">}</span><span class="token operator">></span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> loginSuccess <span class="token operator">=</span> <span class="token function">createAction</span><span class="token punctuation">(</span>
  <span class="token string">'[Auth] Login__SUCCESS'</span><span class="token punctuation">,</span>
  <span class="token generic-function"><span class="token function">props</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token punctuation">{</span> user<span class="token operator">:</span> User<span class="token punctuation">;</span> token<span class="token operator">:</span> <span class="token builtin">string</span> <span class="token punctuation">}</span><span class="token operator">></span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> loginFailure <span class="token operator">=</span> <span class="token function">createAction</span><span class="token punctuation">(</span><span class="token string">'[Auth] Login__FAILURE'</span><span class="token punctuation">,</span> <span class="token generic-function"><span class="token function">props</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token punctuation">{</span> error<span class="token operator">:</span> <span class="token builtin">string</span> <span class="token punctuation">}</span><span class="token operator">></span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<br>
<h2>store/auth/auth.selector.ts</h2>
<div class="gatsby-highlight" data-language="typescript"><pre class="language-typescript"><code class="language-typescript"><span class="token keyword">import</span> <span class="token punctuation">{</span> createFeatureSelector<span class="token punctuation">,</span> createSelector <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@ngrx/store'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> AuthState<span class="token punctuation">,</span> <span class="token constant">AUTH_FEATURE_KEY</span> <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./auth.reducer'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> selectAuthState <span class="token operator">=</span> <span class="token generic-function"><span class="token function">createFeatureSelector</span><span class="token generic class-name"><span class="token operator">&lt;</span>AuthState<span class="token operator">></span></span></span><span class="token punctuation">(</span><span class="token constant">AUTH_FEATURE_KEY</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">const</span> selectToken <span class="token operator">=</span> <span class="token function">createSelector</span><span class="token punctuation">(</span>selectAuthState<span class="token punctuation">,</span> state <span class="token operator">=></span> state<span class="token punctuation">.</span>token<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> selectMe <span class="token operator">=</span> <span class="token function">createSelector</span><span class="token punctuation">(</span>selectAuthState<span class="token punctuation">,</span> state <span class="token operator">=></span> state<span class="token punctuation">.</span>me<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> selectLoading <span class="token operator">=</span> <span class="token function">createSelector</span><span class="token punctuation">(</span>selectAuthState<span class="token punctuation">,</span> state <span class="token operator">=></span> state<span class="token punctuation">.</span>loading<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> selectIsLoggedIn <span class="token operator">=</span> <span class="token function">createSelector</span><span class="token punctuation">(</span>
  selectToken<span class="token punctuation">,</span>
  selectLoading<span class="token punctuation">,</span>
  <span class="token punctuation">(</span>token<span class="token punctuation">,</span> loading<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token operator">!</span><span class="token operator">!</span>token <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>loading<span class="token punctuation">,</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<br>
<h2>store/auth/auth.effect.ts</h2>
<div class="gatsby-highlight" data-language="typescript"><pre class="language-typescript"><code class="language-typescript"><span class="token keyword">import</span> <span class="token punctuation">{</span> Injectable <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@angular/core'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Router <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@angular/router'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> AuthService <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@app/services/auth.service'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Actions<span class="token punctuation">,</span> createEffect<span class="token punctuation">,</span> ofType <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@ngrx/effects'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> <span class="token keyword">of</span> <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'rxjs'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> catchError<span class="token punctuation">,</span> exhaustMap<span class="token punctuation">,</span> map<span class="token punctuation">,</span> tap <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'rxjs/operators'</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token punctuation">{</span> login<span class="token punctuation">,</span> loginFailure<span class="token punctuation">,</span> loginSuccess <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./auth.action'</span><span class="token punctuation">;</span>

@<span class="token function">Injectable</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">AuthEffects</span> <span class="token punctuation">{</span>
  loginEffect$ <span class="token operator">=</span> <span class="token function">createEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>action$<span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>
      <span class="token function">ofType</span><span class="token punctuation">(</span>login<span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token function">exhaustMap</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">{</span> email<span class="token punctuation">,</span> password <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">=></span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>authService<span class="token punctuation">.</span><span class="token function">loginWithLocal</span><span class="token punctuation">(</span>email<span class="token punctuation">,</span> password<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>
          <span class="token function">map</span><span class="token punctuation">(</span>response <span class="token operator">=></span> <span class="token function">loginSuccess</span><span class="token punctuation">(</span><span class="token punctuation">{</span> user<span class="token operator">:</span> response<span class="token punctuation">.</span>user<span class="token punctuation">,</span> token<span class="token operator">:</span> response<span class="token punctuation">.</span>token <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
          <span class="token function">catchError</span><span class="token punctuation">(</span>err <span class="token operator">=></span> <span class="token keyword">of</span><span class="token punctuation">(</span><span class="token function">loginFailure</span><span class="token punctuation">(</span><span class="token punctuation">{</span> error<span class="token operator">:</span> err <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>

  loginSuccessEffect$ <span class="token operator">=</span> <span class="token function">createEffect</span><span class="token punctuation">(</span>
    <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>action$<span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>
        <span class="token function">ofType</span><span class="token punctuation">(</span>loginSuccess<span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token function">tap</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token keyword">this</span><span class="token punctuation">.</span>router<span class="token punctuation">.</span><span class="token function">navigate</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'/posts'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
      dispatch<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">constructor</span><span class="token punctuation">(</span>
    <span class="token keyword">private</span> <span class="token keyword">readonly</span> action$<span class="token operator">:</span> Actions<span class="token punctuation">,</span>
    <span class="token keyword">private</span> <span class="token keyword">readonly</span> authService<span class="token operator">:</span> AuthService<span class="token punctuation">,</span>
    <span class="token keyword">private</span> <span class="token keyword">readonly</span> router<span class="token operator">:</span> Router<span class="token punctuation">,</span>
  <span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre></div>
<br>
<h2>store/auth/auth.module.ts</h2>
<div class="gatsby-highlight" data-language="typescript"><pre class="language-typescript"><code class="language-typescript"><span class="token keyword">import</span> <span class="token punctuation">{</span> NgModule <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@angular/core'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> CommonModule <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@angular/common'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> StoreModule <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@ngrx/store'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> <span class="token constant">AUTH_FEATURE_KEY</span><span class="token punctuation">,</span> reducer <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./auth.reducer'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> EffectsModule <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@ngrx/effects'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> AuthEffects <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./auth.effect'</span><span class="token punctuation">;</span>

@<span class="token function">NgModule</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  imports<span class="token operator">:</span> <span class="token punctuation">[</span>
    CommonModule<span class="token punctuation">,</span>
    StoreModule<span class="token punctuation">.</span><span class="token function">forFeature</span><span class="token punctuation">(</span><span class="token constant">AUTH_FEATURE_KEY</span><span class="token punctuation">,</span> reducer<span class="token punctuation">)</span><span class="token punctuation">,</span>
    EffectsModule<span class="token punctuation">.</span><span class="token function">forFeature</span><span class="token punctuation">(</span><span class="token punctuation">[</span>AuthEffects<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">AuthFeatureStoreModule</span> <span class="token punctuation">{</span><span class="token punctuation">}</span></code></pre></div>
<br>
<h2>store/auth/index.ts</h2>
<div class="gatsby-highlight" data-language="typescript"><pre class="language-typescript"><code class="language-typescript"><span class="token keyword">export</span> <span class="token operator">*</span> <span class="token keyword">from</span> <span class="token string">'./auth.action'</span><span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token operator">*</span> <span class="token keyword">from</span> <span class="token string">'./auth.reducer'</span><span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token operator">*</span> <span class="token keyword">from</span> <span class="token string">'./auth.selector'</span><span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token operator">*</span> <span class="token keyword">from</span> <span class="token string">'./auth.effect'</span><span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token operator">*</span> <span class="token keyword">from</span> <span class="token string">'./auth.module'</span><span class="token punctuation">;</span></code></pre></div>
<h2>store/reducer.ts</h2>
<div class="gatsby-highlight" data-language="typescript"><pre class="language-typescript"><code class="language-typescript"><span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> fromAuth <span class="token keyword">from</span> <span class="token string">'@store/application/auth'</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">interface</span> <span class="token class-name">State</span> <span class="token punctuation">{</span>
  <span class="token punctuation">[</span>fromAuth<span class="token punctuation">.</span><span class="token constant">AUTH_FEATURE_KEY</span><span class="token punctuation">]</span><span class="token operator">:</span> fromAuth<span class="token punctuation">.</span>AuthState<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token punctuation">{</span> fromPost<span class="token punctuation">,</span> fromAuth <span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre></div>
<br>
<h2>store/store.module.ts</h2>
<div class="gatsby-highlight" data-language="typescript"><pre class="language-typescript"><code class="language-typescript"><span class="token keyword">import</span> <span class="token punctuation">{</span> CommonModule <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@angular/common'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> NgModule <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@angular/core'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> EffectsModule <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@ngrx/effects'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> StoreModule <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@ngrx/store'</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token punctuation">{</span> AuthFeatureStoreModule <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./application/auth'</span><span class="token punctuation">;</span>

@<span class="token function">NgModule</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  declarations<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  imports<span class="token operator">:</span> <span class="token punctuation">[</span>
    CommonModule<span class="token punctuation">,</span>
    StoreModule<span class="token punctuation">.</span><span class="token function">forRoot</span><span class="token punctuation">(</span>
      <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        runtimeChecks<span class="token operator">:</span> <span class="token punctuation">{</span>
          strictActionImmutability<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
          strictStateSerializability<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
          strictActionSerializability<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
          strictStateImmutability<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
          strictActionTypeUniqueness<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">)</span><span class="token punctuation">,</span>
    EffectsModule<span class="token punctuation">.</span><span class="token function">forRoot</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    AuthFeatureStoreModule<span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">AppStoreModule</span> <span class="token punctuation">{</span><span class="token punctuation">}</span></code></pre></div>
<h1>Store Entity Feature Module</h1>
<p>Nếu state đó có dạng một list các item hoặc bị lồng vào nhau hãy tham khảo thử bài viết này <a href="https://redux.js.org/recipes/structuring-reducers/normalizing-state-shape">https://redux.js.org/recipes/structuring-reducers/normalizing-state-shape</a>. Trong NgRx có<code class="language-text">@ngrx/entity</code> sẽ hỗ trợ việc đó một cách nhanh chóng.</p>
<h2>store/post/post.reducer.ts</h2>
<div class="gatsby-highlight" data-language="typescript"><pre class="language-typescript"><code class="language-typescript"><span class="token keyword">import</span> <span class="token punctuation">{</span> createEntityAdapter<span class="token punctuation">,</span> EntityAdapter<span class="token punctuation">,</span> EntityState <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@ngrx/entity'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Action<span class="token punctuation">,</span> createReducer<span class="token punctuation">,</span> on <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@ngrx/store'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Post <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@app/models'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> loadPosts<span class="token punctuation">,</span> selectPost <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./post.action'</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token constant">POST_FEATURE_KEY</span> <span class="token operator">=</span> <span class="token string">'posts'</span><span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> adapter<span class="token operator">:</span> EntityAdapter<span class="token operator">&lt;</span>Post<span class="token operator">></span> <span class="token operator">=</span> <span class="token generic-function"><span class="token function">createEntityAdapter</span><span class="token generic class-name"><span class="token operator">&lt;</span>Post<span class="token operator">></span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">interface</span> <span class="token class-name">PostEntityState</span> <span class="token keyword">extends</span> <span class="token class-name">EntityState<span class="token operator">&lt;</span>Post<span class="token operator">></span></span> <span class="token punctuation">{</span>
  selectedPostId<span class="token operator">:</span> <span class="token builtin">number</span> <span class="token operator">|</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">const</span> initialState<span class="token operator">:</span> PostEntityState <span class="token operator">=</span> adapter<span class="token punctuation">.</span><span class="token function">getInitialState</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  selectedPostId<span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> _postReducer <span class="token operator">=</span> <span class="token function">createReducer</span><span class="token punctuation">(</span>
  initialState<span class="token punctuation">,</span>
  <span class="token function">on</span><span class="token punctuation">(</span>selectPost<span class="token punctuation">,</span> <span class="token punctuation">(</span>state<span class="token punctuation">,</span> <span class="token punctuation">{</span> id <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token operator">...</span>state<span class="token punctuation">,</span> selectedPostId<span class="token operator">:</span> id <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token function">on</span><span class="token punctuation">(</span>loadPosts<span class="token punctuation">,</span> <span class="token punctuation">(</span>state<span class="token punctuation">,</span> <span class="token punctuation">{</span> posts <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">=></span> adapter<span class="token punctuation">.</span><span class="token function">addMany</span><span class="token punctuation">(</span>posts<span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token operator">...</span>state<span class="token punctuation">,</span> selectedPostId<span class="token operator">:</span> <span class="token keyword">null</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">reducer</span><span class="token punctuation">(</span>state<span class="token operator">:</span> PostEntityState <span class="token operator">|</span> <span class="token keyword">undefined</span><span class="token punctuation">,</span> action<span class="token operator">:</span> Action<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token function">_postReducer</span><span class="token punctuation">(</span>state<span class="token punctuation">,</span> action<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<br>
<h2>store/post/post.action.ts</h2>
<div class="gatsby-highlight" data-language="typescript"><pre class="language-typescript"><code class="language-typescript"><span class="token keyword">import</span> <span class="token punctuation">{</span> createAction<span class="token punctuation">,</span> props <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@ngrx/store'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Post <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@app/models'</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">const</span> fetchPosts <span class="token operator">=</span> <span class="token function">createAction</span><span class="token punctuation">(</span><span class="token string">'[Post] Fetch Posts'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> selectPost <span class="token operator">=</span> <span class="token function">createAction</span><span class="token punctuation">(</span><span class="token string">'[Post] Select Post'</span><span class="token punctuation">,</span> <span class="token generic-function"><span class="token function">props</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token punctuation">{</span> id<span class="token operator">:</span> <span class="token builtin">number</span> <span class="token punctuation">}</span><span class="token operator">></span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">const</span> loadPosts <span class="token operator">=</span> <span class="token function">createAction</span><span class="token punctuation">(</span><span class="token string">'[Post] Load Posts'</span><span class="token punctuation">,</span> <span class="token generic-function"><span class="token function">props</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token punctuation">{</span> posts<span class="token operator">:</span> Post<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token operator">></span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<br>
<h2>store/post/post.selector.ts</h2>
<div class="gatsby-highlight" data-language="typescript"><pre class="language-typescript"><code class="language-typescript"><span class="token keyword">import</span> <span class="token punctuation">{</span> createFeatureSelector<span class="token punctuation">,</span> createSelector <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@ngrx/store'</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token punctuation">{</span> adapter<span class="token punctuation">,</span> <span class="token constant">POST_FEATURE_KEY</span><span class="token punctuation">,</span> PostEntityState <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./post.reducer'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> selectPostState <span class="token operator">=</span> <span class="token generic-function"><span class="token function">createFeatureSelector</span><span class="token generic class-name"><span class="token operator">&lt;</span>PostEntityState<span class="token operator">></span></span></span><span class="token punctuation">(</span><span class="token constant">POST_FEATURE_KEY</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> selectIds<span class="token punctuation">,</span> selectAll<span class="token punctuation">,</span> selectEntities<span class="token punctuation">,</span> selectTotal <span class="token punctuation">}</span> <span class="token operator">=</span> adapter<span class="token punctuation">.</span><span class="token function">getSelectors</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">const</span> selectPostIds <span class="token operator">=</span> <span class="token function">createSelector</span><span class="token punctuation">(</span>selectPostState<span class="token punctuation">,</span> selectIds<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> selectPostEntities <span class="token operator">=</span> <span class="token function">createSelector</span><span class="token punctuation">(</span>selectPostState<span class="token punctuation">,</span> selectEntities<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> selectPostTotal <span class="token operator">=</span> <span class="token function">createSelector</span><span class="token punctuation">(</span>selectPostState<span class="token punctuation">,</span> selectTotal<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> selectAllPosts <span class="token operator">=</span> <span class="token function">createSelector</span><span class="token punctuation">(</span>selectPostState<span class="token punctuation">,</span> selectAll<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> selectCurrentPostId <span class="token operator">=</span> <span class="token function">createSelector</span><span class="token punctuation">(</span>selectPostState<span class="token punctuation">,</span> state <span class="token operator">=></span> state<span class="token punctuation">.</span>selectedPostId<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> selectCurrentPost <span class="token operator">=</span> <span class="token function">createSelector</span><span class="token punctuation">(</span>
  selectPostEntities<span class="token punctuation">,</span>
  selectCurrentPostId<span class="token punctuation">,</span>
  <span class="token punctuation">(</span>postEntities<span class="token punctuation">,</span> postId<span class="token punctuation">)</span> <span class="token operator">=></span> postEntities<span class="token punctuation">[</span>postId<span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<br>
<h2>store/post/post.effect.ts</h2>
<div class="gatsby-highlight" data-language="typescript"><pre class="language-typescript"><code class="language-typescript"><span class="token keyword">import</span> <span class="token punctuation">{</span> Injectable <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@angular/core'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Actions<span class="token punctuation">,</span> createEffect<span class="token punctuation">,</span> ofType <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@ngrx/effects'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> map<span class="token punctuation">,</span> mergeMapTo <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'rxjs/operators'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> PostService <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@app/services'</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token punctuation">{</span> fetchPosts<span class="token punctuation">,</span> loadPosts <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./post.action'</span><span class="token punctuation">;</span>

@<span class="token function">Injectable</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">PostEffects</span> <span class="token punctuation">{</span>
  fetchPostsEffect$ <span class="token operator">=</span> <span class="token function">createEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>action$<span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>
      <span class="token function">ofType</span><span class="token punctuation">(</span>fetchPosts<span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token function">mergeMapTo</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>postService<span class="token punctuation">.</span><span class="token function">getAllPost</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token function">map</span><span class="token punctuation">(</span>posts <span class="token operator">=></span> <span class="token function">loadPosts</span><span class="token punctuation">(</span><span class="token punctuation">{</span> posts <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">constructor</span><span class="token punctuation">(</span><span class="token keyword">private</span> action$<span class="token operator">:</span> Actions<span class="token punctuation">,</span> <span class="token keyword">private</span> postService<span class="token operator">:</span> PostService<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre></div>
<br>
<h2>store/post/post.module.ts</h2>
<div class="gatsby-highlight" data-language="typescript"><pre class="language-typescript"><code class="language-typescript"><span class="token keyword">import</span> <span class="token punctuation">{</span> CommonModule <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@angular/common'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> NgModule <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@angular/core'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> EffectsModule <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@ngrx/effects'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> StoreModule <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@ngrx/store'</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token punctuation">{</span> PostEffects <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./post.effect'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> <span class="token constant">POST_FEATURE_KEY</span><span class="token punctuation">,</span> reducer <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./post.reducer'</span><span class="token punctuation">;</span>

@<span class="token function">NgModule</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  imports<span class="token operator">:</span> <span class="token punctuation">[</span>
    CommonModule<span class="token punctuation">,</span>
    StoreModule<span class="token punctuation">.</span><span class="token function">forFeature</span><span class="token punctuation">(</span><span class="token constant">POST_FEATURE_KEY</span><span class="token punctuation">,</span> reducer<span class="token punctuation">)</span><span class="token punctuation">,</span>
    EffectsModule<span class="token punctuation">.</span><span class="token function">forFeature</span><span class="token punctuation">(</span><span class="token punctuation">[</span>PostEffects<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">PostFeatureStoreModule</span> <span class="token punctuation">{</span><span class="token punctuation">}</span></code></pre></div>
<br>
<h2>store/post/index.ts</h2>
<div class="gatsby-highlight" data-language="typescript"><pre class="language-typescript"><code class="language-typescript"><span class="token keyword">export</span> <span class="token operator">*</span> <span class="token keyword">from</span> <span class="token string">'./post.action'</span><span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token operator">*</span> <span class="token keyword">from</span> <span class="token string">'./post.reducer'</span><span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token operator">*</span> <span class="token keyword">from</span> <span class="token string">'./post.effect'</span><span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token operator">*</span> <span class="token keyword">from</span> <span class="token string">'./post.selector'</span><span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token operator">*</span> <span class="token keyword">from</span> <span class="token string">'./post.module'</span><span class="token punctuation">;</span></code></pre></div>
<br>
<h2>store/reducer.ts</h2>
<div class="gatsby-highlight" data-language="typescript"><pre class="language-typescript"><code class="language-typescript"><span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> fromPost <span class="token keyword">from</span> <span class="token string">'@store/entities/post'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> fromAuth <span class="token keyword">from</span> <span class="token string">'@store/application/auth'</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">interface</span> <span class="token class-name">State</span> <span class="token punctuation">{</span>
  <span class="token punctuation">[</span>fromPost<span class="token punctuation">.</span><span class="token constant">POST_FEATURE_KEY</span><span class="token punctuation">]</span><span class="token operator">:</span> fromPost<span class="token punctuation">.</span>PostEntityState<span class="token punctuation">;</span>
  <span class="token punctuation">[</span>fromAuth<span class="token punctuation">.</span><span class="token constant">AUTH_FEATURE_KEY</span><span class="token punctuation">]</span><span class="token operator">:</span> fromAuth<span class="token punctuation">.</span>AuthState<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token punctuation">{</span> fromPost<span class="token punctuation">,</span> fromAuth <span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre></div>
<br>
<h2>store/store.module.ts</h2>
<div class="gatsby-highlight" data-language="typescript"><pre class="language-typescript"><code class="language-typescript"><span class="token keyword">import</span> <span class="token punctuation">{</span> CommonModule <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@angular/common'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> NgModule <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@angular/core'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> EffectsModule <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@ngrx/effects'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> StoreModule <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@ngrx/store'</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token punctuation">{</span> PostFeatureStoreModule <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./entities/post'</span><span class="token punctuation">;</span>

@<span class="token function">NgModule</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  declarations<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  imports<span class="token operator">:</span> <span class="token punctuation">[</span>
    CommonModule<span class="token punctuation">,</span>
    StoreModule<span class="token punctuation">.</span><span class="token function">forRoot</span><span class="token punctuation">(</span>
      <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        runtimeChecks<span class="token operator">:</span> <span class="token punctuation">{</span>
          strictActionImmutability<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
          strictStateSerializability<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
          strictActionSerializability<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
          strictStateImmutability<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
          strictActionTypeUniqueness<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">)</span><span class="token punctuation">,</span>
    EffectsModule<span class="token punctuation">.</span><span class="token function">forRoot</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    PostFeatureStoreModule<span class="token punctuation">,</span>
    AuthFeatureStoreModule<span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">AppStoreModule</span> <span class="token punctuation">{</span><span class="token punctuation">}</span></code></pre></div>
<br>
<h1>Sử dụng @ngrx/component-store cho local state</h1>
<p>Với những state cần phải share trong app thì sẽ được quản lý bằng store. Nhưng sẽ có một số state chỉ được sử dụng bởi chính component đó thì <code class="language-text">@ngrx/component-store</code> sẽ là một sự lựa chọn cho ai thích áp dụng Reactive Programming trong Angular nhiều nhất có thể. Nó mang lại một số lợi ích sau:</p>
<ul>
<li>Tách biệt logic quản lý local state của component ra một service riêng.</li>
<li>Reactive hoàn toàn giúp đơn giản hơn trong việc kết hợp với các state khác bằng các operator của RxJS.</li>
<li>Tất cả logic về get, update state đều được thực hiện qua RxJS giúp được viết theo style declarative rất dễ hiểu (nếu người đọc cũng có nền tảng tốt về Functional Programming và Reactive Programming).</li>
</ul>
<h1>Tổng kết</h1>
<p>Về cơ bản thì trong angular chúng ta có thể phần chia code thành các module và khi sử dụng NgRx thì mình thường cho store là một module riêng. Module này sẽ được import vào App Module và load ngay từ đầu chứ không cần lazy load gì cả. </p>
<p>Structure đề nghị sẽ như thế này</p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash"><span class="token builtin class-name">.</span>
├── app
│   ├── app-routing.module.ts
│   ├── app.module.ts
│   ├── features
│   │   ├── board
│   │   │   ├── board-routing.module.ts
│   │   │   ├── board.component.html
│   │   │   ├── board.component.scss
│   │   │   ├── board.component.ts
│   │   │   ├── board.module.ts
│   │   │   ├── header
│   │   │   │   ├── __snapshots__
│   │   │   │   │   └── header.component.spec.ts.snap
│   │   │   │   ├── header.component.html
│   │   │   │   ├── header.component.scss
│   │   │   │   ├── header.component.spec.ts
│   │   │   │   └── header.component.ts
│   │   │   └── index.ts
│   │   ├── login
│   │   │   ├── __snapshots__
│   │   │   ├── index.ts
│   │   │   ├── login-form
│   │   │   │   ├── __snapshots__
│   │   │   │   │   └── login-form.component.spec.ts.snap
│   │   │   │   ├── login-form.component.html
│   │   │   │   ├── login-form.component.scss
│   │   │   │   ├── login-form.component.spec.ts
│   │   │   │   ├── login-form.component.ts
│   │   │   │   └── login-form.store.ts
│   │   │   ├── login-routing.module.ts
│   │   │   ├── login.component.html
│   │   │   ├── login.component.scss
│   │   │   ├── login.component.ts
│   │   │   └── login.module.ts
│   │   └── posts
│   │       ├── __snapshots__
│   │       ├── index.ts
│   │       ├── post-detail
│   │       │   ├── __snapshots__
│   │       │   │   └── post-detail.component.spec.ts.snap
│   │       │   ├── post-detail.component.html
│   │       │   ├── post-detail.component.scss
│   │       │   ├── post-detail.component.spec.ts
│   │       │   └── post-detail.component.ts
│   │       ├── post-list
│   │       │   ├── __snapshots__
│   │       │   │   └── post-list.component.spec.ts.snap
│   │       │   ├── post-list.component.html
│   │       │   ├── post-list.component.scss
│   │       │   ├── post-list.component.spec.ts
│   │       │   └── post-list.component.ts
│   │       ├── posts-routing.module.ts
│   │       ├── posts.component.html
│   │       ├── posts.component.scss
│   │       ├── posts.component.ts
│   │       └── posts.module.ts
│   ├── guards
│   │   ├── auth.guard.spec.ts
│   │   ├── auth.guard.ts
│   │   ├── login.guard.spec.ts
│   │   └── login.guard.ts
│   ├── main
│   │   ├── __snapshots__
│   │   │   └── main.component.spec.ts.snap
│   │   ├── main.component.html
│   │   ├── main.component.scss
│   │   ├── main.component.spec.ts
│   │   └── main.component.ts
│   ├── models
│   │   ├── index.ts
│   │   ├── post.model.ts
│   │   └── user.model.ts
│   ├── services
│   │   ├── auth.service.ts
│   │   ├── index.ts
│   │   └── post.service.ts
│   └── store
│       ├── auth
│       │   ├── auth.action.ts
│       │   ├── auth.effect.ts
│       │   ├── auth.module.ts
│       │   ├── auth.reducer.ts
│       │   ├── auth.selector.ts
│       │   └── index.ts
│       ├── post
│       │   ├── index.ts
│       │   ├── post.action.ts
│       │   ├── post.effect.ts
│       │   ├── post.module.ts
│       │   ├── post.reducer.ts
│       │   └── post.selector.ts
│       ├── reducers.ts
│       └── store.module.ts
├── assets
├── environments
│   ├── environment.prod.ts
│   └── environment.ts
├── favicon.ico
├── index.html
├── main.ts
├── polyfills.ts
├── styles.scss
└── theme
    └── base.scss</code></pre></div></div></div></div></div><div id="gatsby-announcer" style="position:absolute;top:0;width:1px;height:1px;padding:0;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border:0" aria-live="assertive" aria-atomic="true"></div></div><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/vi/state-management-with-ngrx-in-angular";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"polyfill":["/polyfill-64742d1bff844b746df5.js"],"app":["/app-68672042ae7cb9401002.js"],"component---src-pages-404-tsx":["/component---src-pages-404-tsx-6f03b54c21f26745ac29.js"],"component---src-pages-index-tsx":["/component---src-pages-index-tsx-7cd95f1abbd1d5a4844a.js"],"component---src-templates-blog-post-tsx":["/component---src-templates-blog-post-tsx-66c6938f7d1532686151.js"]};/*]]>*/</script><script src="/next-blog/polyfill-64742d1bff844b746df5.js" nomodule=""></script><script src="/next-blog/component---src-templates-blog-post-tsx-66c6938f7d1532686151.js" async=""></script><script src="/next-blog/022d3153bf09c36cd784dcdb36ffbd187f9c96d7-8695945ca61dfd864cb3.js" async=""></script><script src="/next-blog/commons-518e58bf6a7d4015b30b.js" async=""></script><script src="/next-blog/05d954cf-c6db298c906c9c30084e.js" async=""></script><script src="/next-blog/app-68672042ae7cb9401002.js" async=""></script><script src="/next-blog/styles-755093da0c07f4b49226.js" async=""></script><script src="/next-blog/framework-8aba4025690a031b46dc.js" async=""></script><script src="/next-blog/webpack-runtime-6ce45a7ec86322bce28b.js" async=""></script></body></html>